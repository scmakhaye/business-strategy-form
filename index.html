<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Success Automation - Questionnaire</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #003366 0%, #0066cc 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .progress-bar {
            height: 4px;
            background: #ddd;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
        }
        
        .form-content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            color: #003366;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: inline-block;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1em;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .currency-note {
            color: #666;
            font-size: 0.9em;
            font-style: italic;
            margin-top: 5px;
        }
        
        .helper-text {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        input[type="file"] {
            padding: 10px;
            cursor: pointer;
        }
        
        .logo-preview {
            margin-top: 15px;
            max-width: 200px;
            max-height: 100px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            display: none;
        }
        
        .logo-preview img {
            max-width: 100%;
            max-height: 80px;
            display: block;
        }
        
        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-radius: 5px;
            font-size: 0.9em;
            color: #003366;
            display: none;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .radio-option,
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        input[type="radio"],
        input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #c62828;
            display: none;
        }
        
        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2e7d32;
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .form-content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Business Success Automation</h1>
            <p>Complete this questionnaire to receive 5 customized strategy documents</p>
            <p style="margin-top: 10px; font-size: 0.9em;">üáøüá¶ All financial values in South African Rands (ZAR)</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="form-content">
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
              <form id="businessForm" action="https://msizabeer.app.n8n.cloud/webhook/business-assessment" method="POST">

                <!-- Section 1: Business Profile -->
                <div class="section">
                    <h2 class="section-title">üè¢ Business Profile</h2>
                    
                    <div class="form-group">
                        <label for="businessLogo">Business Logo</label>
                        <input type="file" id="businessLogo" name="businessLogo" accept="image/png,image/jpeg,image/jpg" onchange="previewLogo(event)">
                        <div class="helper-text">Upload your company logo (PNG or JPG, max 2MB). This will appear on all documents.</div>
                        <div class="logo-preview" id="logoPreview">
                            <img id="logoImage" src="" alt="Logo preview">
                        </div>
                        <div class="file-info" id="logoInfo"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="businessName">Business Name <span class="required">*</span></label>
                        <input type="text" id="businessName" name="businessName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="businessEmail">Business Email <span class="required">*</span></label>
                        <input type="email" id="businessEmail" name="businessEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="businessAddress">Business Address <span class="required">*</span></label>
                        <textarea id="businessAddress" name="businessAddress" required placeholder="Street address, City, Province, Postal Code"></textarea>
                        <div class="helper-text">This will appear on all documents</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="businessPhone">Business Phone</label>
                        <input type="text" id="businessPhone" name="businessPhone" placeholder="+27 XX XXX XXXX">
                    </div>
                    
                    <div class="form-group">
                        <label for="businessWebsite">Business Website</label>
                        <input type="text" id="businessWebsite" name="businessWebsite" placeholder="https://www.yourcompany.co.za">
                    </div>
                    
                    <div class="form-group">
                        <label for="industry">Industry <span class="required">*</span></label>
                        <select id="industry" name="industry" required>
                            <option value="">Select your industry</option>
                            <option value="Agriculture">Agriculture</option>
                            <option value="Automotive">Automotive</option>
                            <option value="Construction">Construction</option>
                            <option value="Consulting">Consulting</option>
                            <option value="Education">Education</option>
                            <option value="Energy">Energy</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Finance">Finance</option>
                            <option value="Food & Beverage">Food & Beverage</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Hospitality">Hospitality</option>
                            <option value="Manufacturing">Manufacturing</option>
                            <option value="Mining">Mining</option>
                            <option value="Real Estate">Real Estate</option>
                            <option value="Retail">Retail</option>
                            <option value="Technology">Technology</option>
                            <option value="Tourism">Tourism</option>
                            <option value="Transportation">Transportation</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="yearsInOperation">Years in Operation <span class="required">*</span></label>
                        <input type="number" id="yearsInOperation" name="yearsInOperation" min="0" max="200" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="businessDescription">Business Description <span class="required">*</span></label>
                        <textarea id="businessDescription" name="businessDescription" required placeholder="Describe what your business does, your products/services, and what makes you unique"></textarea>
                    </div>
                </div>
                
                <!-- Section 2: Current State -->
                <div class="section">
                    <h2 class="section-title">üìä Current State</h2>
                    
                    <div class="form-group">
                        <label for="annualRevenue">Annual Revenue (ZAR) <span class="required">*</span></label>
                        <select id="annualRevenue" name="annualRevenue" required>
                            <option value="">Select range</option>
                            <option value="R0-R100k">R0 - R100,000</option>
                            <option value="R100k-R500k">R100,000 - R500,000</option>
                            <option value="R500k-R1M">R500,000 - R1 Million</option>
                            <option value="R1M-R5M">R1 Million - R5 Million</option>
                            <option value="R5M-R10M">R5 Million - R10 Million</option>
                            <option value="R10M-R50M">R10 Million - R50 Million</option>
                            <option value="R50M+">R50 Million+</option>
                        </select>
                        <div class="currency-note">All amounts in South African Rands (ZAR)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="challenges">Current Challenges <span class="required">*</span></label>
                        <textarea id="challenges" name="challenges" required placeholder="What are your biggest business challenges right now?"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="financialDifficulties">Are you currently experiencing financial difficulties? <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="finDiffYes" name="financialDifficulties" value="Yes" required>
                                <label for="finDiffYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="finDiffNo" name="financialDifficulties" value="No" required>
                                <label for="finDiffNo">No</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Section 3: Goals -->
                <div class="section">
                    <h2 class="section-title">üéØ Goals & Vision</h2>
                    
                    <div class="form-group">
                        <label for="year1Goal">Primary Goal for Year 1 <span class="required">*</span></label>
                        <textarea id="year1Goal" name="year1Goal" required placeholder="What do you want to achieve in the next 12 months?"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="fiveYearRevenue">5-Year Revenue Target (ZAR) <span class="required">*</span></label>
                        <input type="number" id="fiveYearRevenue" name="fiveYearRevenue" min="0" required placeholder="Target annual revenue in 5 years (e.g., 10000000 for R10M)">
                        <div class="currency-note">Enter amount in Rands (ZAR)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="fiveYearVision">5-Year Vision <span class="required">*</span></label>
                        <textarea id="fiveYearVision" name="fiveYearVision" required placeholder="Describe where you want your business to be in 5 years"></textarea>
                    </div>
                </div>
                
                <!-- Section 4: Market & Competition -->
                <div class="section">
                    <h2 class="section-title">üéØ Market & Competition</h2>
                    
                    <div class="form-group">
                        <label for="targetMarket">Target Market <span class="required">*</span></label>
                        <textarea id="targetMarket" name="targetMarket" required placeholder="Describe your ideal customers (e.g., South African SMEs, Gauteng consumers, etc.)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="competitors">Main Competitors</label>
                        <textarea id="competitors" name="competitors" placeholder="List your main competitors in the South African market"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="competitiveAdvantages">Competitive Advantages</label>
                        <textarea id="competitiveAdvantages" name="competitiveAdvantages" placeholder="What makes you better than competitors?"></textarea>
                    </div>
                </div>
                
                <!-- Section 5: Marketing -->
                <div class="section">
                    <h2 class="section-title">üì£ Marketing & Sales</h2>
                    
                    <div class="form-group">
                        <label>Current Marketing Channels</label>
                        <div class="checkbox-group">
                            <div class="checkbox-option">
                                <input type="checkbox" id="mcSocial" name="marketingChannels" value="Social Media">
                                <label for="mcSocial">Social Media</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="mcEmail" name="marketingChannels" value="Email Marketing">
                                <label for="mcEmail">Email Marketing</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="mcSEO" name="marketingChannels" value="SEO">
                                <label for="mcSEO">SEO</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="mcPaid" name="marketingChannels" value="Paid Ads">
                                <label for="mcPaid">Paid Ads</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="mcReferral" name="marketingChannels" value="Referrals">
                                <label for="mcReferral">Referrals</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="marketingBudget">Monthly Marketing Budget (ZAR)</label>
                        <input type="number" id="marketingBudget" name="marketingBudget" min="0" placeholder="Available budget per month in Rands">
                        <div class="currency-note">Enter amount in Rands (ZAR)</div>
                    </div>
                </div>
                
                <!-- Section 6: Operations -->
                <div class="section">
                    <h2 class="section-title">‚öôÔ∏è Operations</h2>
                    
                    <div class="form-group">
                        <label for="productionCapacity">Current Production/Service Capacity</label>
                        <textarea id="productionCapacity" name="productionCapacity" placeholder="Describe your current capacity and limitations"></textarea>
                    </div>
                </div>
                
                <!-- Section 7: Financial Details -->
                <div class="section">
                    <h2 class="section-title">üí∞ Financial Details (All in ZAR)</h2>
                    
                    <div class="form-group">
                        <label for="currentAssets">Current Assets Value (ZAR) <span class="required">*</span></label>
                        <input type="number" id="currentAssets" name="currentAssets" min="0" required placeholder="Total value of all assets in Rands">
                        <div class="currency-note">Enter amount in Rands (ZAR)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="currentLiabilities">Current Liabilities/Debt (ZAR) <span class="required">*</span></label>
                        <input type="number" id="currentLiabilities" name="currentLiabilities" min="0" required placeholder="Total debts and liabilities in Rands">
                        <div class="currency-note">Enter amount in Rands (ZAR)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="workingCapital">Available Working Capital (ZAR) <span class="required">*</span></label>
                        <input type="number" id="workingCapital" name="workingCapital" min="0" required placeholder="Cash available for operations in Rands">
                        <div class="currency-note">Enter amount in Rands (ZAR)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="breakEvenPoint">Break-even Point (ZAR) <span class="required">*</span></label>
                        <input type="number" id="breakEvenPoint" name="breakEvenPoint" min="0" required placeholder="Monthly revenue needed to break even in Rands">
                        <div class="currency-note">Enter monthly amount in Rands (ZAR)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="investmentCapacity">Investment Capacity for Growth (ZAR)</label>
                        <input type="number" id="investmentCapacity" name="investmentCapacity" min="0" placeholder="How much can you invest in growth? (in Rands)">
                        <div class="currency-note">Enter amount in Rands (ZAR)</div>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn">üöÄ Generate My Business Strategy Documents</button>
            </form>
        </div>
    </div>
    
    <script>
        // ============================================
        // PRODUCTION WEBHOOK URL - CONFIGURED
        // ============================================
        const WEBHOOK_URL = 'https://msizabeer.app.n8n.cloud/webhook/business-assessment';
        
        // Logo preview function
        function previewLogo(event) {
            const file = event.target.files[0];
            const logoPreview = document.getElementById('logoPreview');
            const logoImage = document.getElementById('logoImage');
            const logoInfo = document.getElementById('logoInfo');
            
            if (file) {
                // Check file size (2MB limit)
                if (file.size > 2 * 1024 * 1024) {
                    alert('Logo file size must be less than 2MB');
                    event.target.value = '';
                    return;
                }
                
                // Check file type
                if (!file.type.match('image/(png|jpeg|jpg)')) {
                    alert('Logo must be PNG or JPG format');
                    event.target.value = '';
                    return;
                }
                
                // Show preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoImage.src = e.target.result;
                    logoPreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
                
                // Show file info
                logoInfo.textContent = `‚úì ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                logoInfo.style.display = 'block';
            }
        }
        
        // Progress indicator
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById("progressBar").style.width = scrolled + "%";
        });
        
        // Form submission with logo upload
        document.getElementById('businessForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Hide any previous messages
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            
            const formData = new FormData(e.target);
            const data = {
                currency: 'ZAR',
                country: 'South Africa'
            };
            
            // Handle logo file
            const logoFile = document.getElementById('businessLogo').files[0];
            if (logoFile) {
                try {
                    const logoBase64 = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => {
                            // Get base64 without the data:image/png;base64, prefix
                            const base64 = reader.result.split(',')[1];
                            resolve(base64);
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(logoFile);
                    });
                    
                    data.businessLogo = {
                        data: logoBase64,
                        filename: logoFile.name,
                        mimeType: logoFile.type,
                        size: logoFile.size
                    };
                } catch (error) {
                    console.error('Error reading logo file:', error);
                    showError('Failed to process logo file. Please try again.');
                    return;
                }
            }
            
            // Convert form data to JSON
            for (let [key, value] of formData.entries()) {
                if (key === 'marketingChannels') {
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else if (key !== 'businessLogo') {
                    data[key] = value;
                }
            }
            
            // Handle checkboxes that weren't selected
            if (!data.marketingChannels) {
                data.marketingChannels = ['None'];
            }
            
            console.log('Submitting to:', WEBHOOK_URL);
            console.log('Data includes logo:', !!data.businessLogo);
            
            // Show loading state
            const submitBtn = document.querySelector('.submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '‚è≥ Processing... This may take 2-3 minutes';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    mode: 'cors'
                });
                
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Response data:', result);
                    
                    let successMsg = '‚úÖ Success! Your business strategy documents are being generated';
                    if (data.businessLogo) {
                        successMsg += ' with your company logo';
                    }
                    successMsg += '. Check your email (' + data.businessEmail + ') in 2-3 minutes for all 5 branded documents.';
                    
                    showSuccess(successMsg);
                    e.target.reset();
                    document.getElementById('logoPreview').style.display = 'none';
                    document.getElementById('logoInfo').style.display = 'none';
                    
                    // Scroll to top to show success message
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    throw new Error(`Server returned ${response.status}: ${errorText}`);
                }
            } catch (error) {
                console.error('Submission error:', error);
                
                let errorMessage = '‚ùå There was an error submitting your form. ';
                
                if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                    errorMessage += 'Please check your internet connection and try again.';
                } else if (error.message.includes('404')) {
                    errorMessage += 'The submission endpoint was not found. Please contact support.';
                } else if (error.message.includes('CORS')) {
                    errorMessage += 'Cross-origin request blocked. Please contact support.';
                } else if (error.message.includes('500')) {
                    errorMessage += 'Server error. The workflow may not be active. Please try again in a few minutes.';
                } else {
                    errorMessage += 'Please try again or contact support if the problem persists. Error: ' + error.message;
                }
                
                showError(errorMessage);
                
                // Scroll to top to show error message
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = message;
            errorDiv.style.display = 'block';
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.innerHTML = message;
            successDiv.style.display = 'block';
        }
        
        // Log configuration on page load
        console.log('Business Success Automation Form Loaded (ZAR + Logo Support)');
        console.log('Webhook URL:', WEBHOOK_URL);
        console.log('Currency: South African Rand (ZAR)');
        console.log('Logo upload: Enabled');
        console.log('Ready to submit!');
    </script>
</body>
</html>
